라우터

1. 정의&특징

- 라우터란? 네트워크 간을 연결해서 패킷이 목적지에 전달될 때까지 효율적(홉 수, 빠른 길 등등)으로 길 안내를 하는 기기.
- 라우터의 네트워크 계층에서는 IP헤더에 기록된 목적지IP주소를 보고 다음 전송처를 결정(송신에서 수신까지 여러개의 네트워크를 경우하니깐 전송처의 길이 여러개라고 보면 됨.)
- 들어온 패킷의 목적지 주소가 라우팅 테이블에 없으면 패킷을 버린다.
- 라우터는 패킷 포워딩 과정에서 기존 2계층헤더를 제거한 후 **새로운 2계층 헤더**를 만들어 낸다.
- 라우터 갯수를 몇개 통과했는지를 말할 때, 단위를 홉(hop)이라고 한다. ex) 송신에서 수신으로 가기위해서, 송신지 => b라우터 => c라우텨 = > d라우터 => 수신지 를 거쳤다면, 3홉(3hop)이라고 할 수 있다.
- 데이터 링크 계층으로부터 패킷을 회수 => 목적지까지 경로를 결정하거나 패킷의 크기를 조정 => 라우터를 옮겨가며 목적지 네트워크로 전달
- 라우터가 네트워크를 거친다고 해서 내부를 통과하는 것이 아님. 네트워크 입구에 설치 된 라우터를 전전하면 목적지의 네트워크 입구까지 도달.
- 라우터가 다음 목적지인 라우터를 정하면 거기를 향해서 패킷을 전송하는 작업을 하는데, 이 패킷 전송 작업을 **라우팅**이 한다.
- 라우팅 수행을 위해서 라우터가 **라우팅 테이블**을 참고해서 다음 라우터를 결정한다. 라우팅 테이블은 라우터 안에 저장되어 있다.
- 라우터는 **MAC주소를 사용하여 경유지를 지정**한다. => IP주소는 최종 목적지, MAC주소는 경유지를 나타냄.
- 전체적인 과정  
  ex) 만약 IP : A에서 IP : B로 가야하고,  
  IP : A, MAC : a / IP : B, MAC : b / IP : W, MAC : w / IP : X, MAC : x / IP : Y, MAC : y 가 존재.  
  네트워크 계층에서 수신IP주소 확인 => 라우터가 라우팅테이블을 이용해 다음 전송할 라우터 판단(IP주소는 B) => 데이터링크 계층에서는 그 다음은 전송처의 MAC주소를 추가하여 네트워크로 보냄.(MAC 주소는 w) => 경유지 MAC주소가 w인 곳을 경유, MAC주소 x로 바꿈 => 경유지 MAC주소가 x인 곳을 경유, MAC주소 y로 바꿈 => 경유지 MAC주소가 y인 곳을 경유, MAC주소 b로 바꿈 => 경유지 MAC주소가 b인 곳으로 감. 여기의 IP주소가 B임. 최종 목적지에 도달.

2. 라우팅

- 라우팅이란? 라우터에서 다음 라우터까지의 패킷 전송하는 작업.
- 종류  
  a. 정적 라우팅 : 미리 관리자(사용자)가 등록해 둔 라우팅 테이블을 사용하여 목적지에 전달
  => 경로가 고정되어 있어, 그 경로들 중에 한 군데라도 상태가 잘 못 되어 있으면 전달하지 않는다.  
  b. 동적 라우팅 : 라우터가 정보 교환을 통해, 그 시점에서 가장 적절한 경로를 선택
  => 경로 상태가 잘 못 되어 있으면, 자동으로 다른 경로를 선택한다.
  => 동적 라우팅 같은 경우, 라우터들이 직접 연결되어 있는 다른 라우터로부터 정보를 얻어 라우팅 테이블을 작성 해야하는데 이 때 **라우팅 프로토콜**을 사용한다.
- 라우팅 프로토콜 종류

    <p align="center">
    <img src="https://github.com/goodlucky1215/CS_Study/blob/main/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/tcp_ip%EA%B3%84%EC%B8%B5(5%EA%B3%84%EC%B8%B5)/%EC%82%AC%EC%A7%84/3-1.%EB%9D%BC%EC%9A%B0%ED%84%B0/%EB%9D%BC%EC%9A%B0%ED%8C%85%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C.png"
      width="700"
      height="300" />

  A. IGP(Internal Gateway Protocol) : 동일한 조직에 속한 라우터끼리 주고 받기 위한 프로토콜 ex) RIP, OSPE  
   a. RIP(Routing Information Protocol) : 중소 규모 내 사용, 목적지까지의 라우터 수(홉 수)를 중시 해 라우팅 테이블 작성  
   b. OSPE(Open Shortest Path First) : 중대 규모 내 사용, 전송 속도를 고려하고 목적지까지의 속도를 중시 해 라우팅 테이블 작성  
  B. EGP(Exterior Gateway Protocol) : 서로 다른 조직에 속한 라우터끼리 주고 받기 위한 프로토콜 ex) BGP  
   a. BGP(Border Gateway Protocol) : 목적지까지의 라우터 수(홉 수)를 중시해 라우팅 테이블을 작성  
  => 여기서 동일한 조직, 서로 다른 조직을 구분 짓는 건 AS(Autonomous System)으로 **동일한 라우터 정책이 적용된 영역을 의미한다.**

3. 라우팅 테이블

- 목적지로 통하는 경로들에 대한 정보를 가지고 있다.
- 라우팅 테이블 주요 항목

    <p align="center">
    <img src="https://github.com/goodlucky1215/CS_Study/blob/main/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/tcp_ip%EA%B3%84%EC%B8%B5(5%EA%B3%84%EC%B8%B5)/%EC%82%AC%EC%A7%84/3-1.%EB%9D%BC%EC%9A%B0%ED%84%B0/routing_table.png"
    width="800"
    height="300" />

  a. 수신 네트워크 : 라우터가 파악하고 있는 네트워크의 네트워크 주소와 서브넷 마스크가 들어간다.  
   b. 넥스트 홉 주소 : a의 네트워크에 전달하기 위한 다음 전송처가 되는 라우터의 IP주소와 서브넷 마스크가 들어간다.  
   c. 메트릭 : 경로의 최적도를 나타내는 수치로, 값이 적을수록 뛰어난 경로이다.  
   d. 출력 인터페이스 : 다음 전송처의 데이터 링크 정보가 들어간다. 이에 의해 데이터 링크 계층의 어떤 프로토콜을 사용하여 캡슐화할지가 결정된다.  
   e. 경로의 정보원 : 이 정보가 수동으로 등록되었는지, 어떤 라우팅 프로토콜을 사용하여 자동으로 등록되었는지를 표시하는 문자가 들어간다. (R이 라우팅 프로토콜이고, 수동은 관리자라고 적혀있음)
  f. 경과 시간 : 경로가 등록된 이후로 경과한 시간이 들어간다. 라우팅 프로토콜에 따라서 이 정보를 바탕으로 경로가 현재도 사용 가능한지를 판단한다.  
   => 등록할 수 있는 테이블의 수는 라우터의 종류에 따라 다르다.

  \*라우팅 테이블의 이정보로 어떻게 더 돌아가는지 알아보기????????????????????????????????????
  라우터가 그러면 ARP프로토콜로 일단 MAC주소를 찾고 나서 다음 라우터로 찾아가는건가

4. 라우터의 역할

(1) 경로 지정

- 경로 정보를 모아 라우팅 테이블을 만들고 패킷이 라우터로 들어오면 패킷의 도착지IP주소를 확인해 결로를 지정하고 패킷을 포워딩한다. => 경로 정보를 얻는 역할 / 정보를 확인하고 패킷을 포워딩 하는 역할
- 라우터는 자신이 얻은 경로의 정보에 포함되는 패킷만 포워딩한다. 그러므로 정확한 목적지 경로를 얻는것은 중요!!
- 관리자가 직접 경로 정보 입력 / IP주소를 입력하면 인접 네트워크 정보를 얻는 방법 / 라우터끼리 서로 경로 정보를 자동으로 교환하는 방법

(2) 브로드캐스트 컨트롤

- 라우터는 바로 연결되어 있는 네트워크 정보를 제외하고, 경로 습득 설정을 하지 않으면 패킷을 포워딩하지 않는다. 이 기능을 이용해 브로드캐스트가 다른 네트워크로 전파되는 것을 막는다. 이를 브로드캐스트 컨트롤라고 한다.
- 라우터는 분명한 도착지 정보가 있을 때만 통신을 허락한다.

(3) 프로토콜 변환

- 라우터가 서로 다른 프로토콜로 구성된 네트워크를 연결하는 역할.
- 과거에는 LAN과 WAN에 쓰이는 프로토콜이 전혀 달랐고, LAN기술이 WAN기술로 변환되어야만 인터넷과 통신이 가능했고 이 역할을 라우터가 했다. => 현재는 이더넷으로 인해 이 역할이 많이 줄어듬.
