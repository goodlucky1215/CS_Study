- 4계층 이상에서 동작하는 로드 밸런서, 방화벽 같은 장비를 '세션 장비'라고 부르기도 한다.
- 세션 장비에서 고려할 점 3가지  
  (1) 세션 테이블 : 세션 장비는 세션 테이블을 기반으로 운영. 세션 정보를 저장, 확인하는 작업 전반에 대한 이해 필요. 세션 정보는 세선 테이블에 남아 있는 라이프타임이 존재.  
  (2) Symmetric(대칭)경로 요구 : 인바운드와 아웃바운드 경로가 일치해야 한다.  
  (3) 정보 변경(로드 밸런스의 경우) : IP주소가 변경되며 확장된 L7로드 밸런스(ADC)는 애플리케이션 프로토콜 정보도 변경 된다.

  [로드 밸런서]

  - 서버나 장비의 부하를 분산하기 위해 사용하는 장비를 **로드 밸런서**라고 부른다.
  - 트래픽을 분해해주는 기능, 4계층 이상에서 동작하면서 IP주소나 4계층 정보, 애플리케이션 정보를 확인, 수정하는 기능이 있다.
  - 가장 많이 쓰이는 분야는 웹 서버의 부하 분산.
  - 4계층/7계층 로드 밸런서  
    (1) L4 로드 밸런싱  
     a. TCP, UDP 정보(특히 포트 넘버)를 기반으로 로드 밸런싱을 수행  
     b. 최근 로드 밸런서는 L4, L7의 기능을 모두 지원  
    (2) L7 로드 밸런싱  
    a. HTTP, FTP, SMTP와 같은 애플리케이션 프로토콜 정보를 기반으로 로드 밸런싱 수행
    b. HTTP헤더 정보나 URI와 같은 정보를 기반으로 프로토콜을 이해한 후 부하를 분산 => ADC라고 부름.(프록시 역할 수행)

[로드밸런스 종류의 특징]  
(1) 4계층 - L4스위치

- 외형은 로드 밸런서 이지만 스위치처럼 여러개의 포트를 가진다.
- 부하 분산, 성능 최적화, 리다이렉션 기능을 제공
- L4스위치가 동작하려면, 가상 서버 / 가상IP(VIP) / 리얼 서버 / 리얼IP를 설정해야 한다.
- 가상 서버는 사용자가 바라보는 실제 서비스이고, 가상IP는 사용자가 접근하는 IP주소이다. 리얼 서버는 실제 서비스를 수행하는 서버이고 리얼IP는 실제 서버의 IP이다.
- L4스위치는 가상IP를 리얼IP로 변경해주는 역할을 한다.
- 사용자는 가상IP를 목적지로 서비스 요청하고 L4스위치가 목적지로 설정된 가상IP를 리얼IP로 다시 변경해서 보내준다.

(2) 7계층(tcp/ip의 5계층) - L7스위치, ADC(Application Delivery Controller)

- 애플리케이션 계층의 로드밸런스이다.
- (애플리케이션 헤더와 내용을 이해하기때문에) 부하 분산, 정보 수정, 정보 필터링이 가능하다. => 이러한 동작은 프락시로 동작한다.
- 4계층의 스위치 기능도 가능하다.

\*참고

- 스케일 업 : 하드웨어 성능 자체를 업그레이드, 비싸다, 쉽게 서비스 사용량을 늘릴 수 있다.
- 스케일 아웃 : 여러개 분산해서 서비스를 처리하는 방법, 비교적 싼 편이다, 복잡하고 네트워크 장비가 추가로 필요할 수 있다.

[세션 장비]

- 세션 : 클라이언트와 웹서버 간 네트워크 연결이 지속 유지되고 있는 상태
- 세션 테이블(상태 테이블) : 상태 정보를 담아두는 공간(출발지IP, 목적지IP, 출발지port, 목적지port)
- 세션 정보가 없다면, 패킷이 내부에서 시작한 것인지 외부에서 시작한 것인지 알 수 없게 된다. => 인터넷 연결 정책을 관리하는 인터넷 방화벽 기본 정책 상, 나가는 모든 패킷은 허용하고 들어오는 모든 패킷은 차단하기 때문!
- 세션 시간이 너무 짧다면? 3방향 핸드셰이크를 통해 정상적으로 세션 설정 => 세션 타임으로 세션 테이블 만료 => 애플리케이션 통신 시작(데이터를 전송) => 세션이 이미 만료되어 패킷 드롭
- 개발자 입장에서 세션 시간을 늘릴 수 있는 방법은? 애플리케이션에 주기적으로 패킷을 전송(더미 패킷, Health Check 패킷) => 중간 방화벽에 세션 타임아웃이 발생하기 전에 세션을 유지할 수 있게 됨.(최근 대부분의 플랫폼에서는 이런 기능을 내장하고 개발하도록 안내)

[비대칭 경로 문제]

- 네트워크 안정성을 위해 네트워크 회선과 장비를 이중화 => 패킷이 지나가는 경로가 2개이상이므로 인바운드 패킷과 아웃바운드 패킷의 경로가 같거나 다름 => 인바운드 패킷과 아웃바운드 패킷이 같은 장비를 통과하면 대칭 경로, 다른 장비 통과하면 비대칭 경로라고 함.
- 세션 장비는 패킷이 들어오고 나갈 때 동일한 장비를 통과해야한다. ex) 이중화로 된 방화벽1, 방화벽2가 있다고 했을때 => 인바운드 패킷은 방화벽1, 아웃바운드 패킷은 방화벽2를 통과한다면 세션 정보가 없어서 드롭된다. => 비대칭 경로 문제
- 비대칭 경로 문제 해결 방법  
   (1) 방화벽들끼리의 세션 테이블을 동기화
  - 세션을 동기화하는 시간보다 패킷 응답이 빠르면 정상적으로 동작하지 않을 수 있다는 단점이 있다.  
    (2) 비대칭 경로가 생길 경우, 세션 장비에서 보정하는 방법
  - ex) 이중화로 된 방화벽1, 방화벽2가 있다고 했을때 => 인바운드 패킷은 방화벽1, 아웃바운드 패킷은 방화벽2를 통과한다면, 아웃바운드 패킷의 경로를 다시 보정(터널링, MAC리라이팅)해서 방화벽1로 통하여 들어갈 수 있게 한다.
