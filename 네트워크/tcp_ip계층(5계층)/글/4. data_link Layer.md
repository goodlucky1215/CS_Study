데이터 링크 계층(Data Link Layer)

1. 정의

- 네트워크 간의 차이를 흡수 => 데이터 링크 간의 차이를 흡수해서 네트워크 계층보다 위에 있는 계층이 그 차이를 의식하지 않고 작동 할 수 있게 하는 역할.
- 데이터에 헤더를 붙인 것을 **프레임**이라고 한다.
- 데이터 링크란? 같은 규칙을 바탕으로 연결되어 있는 한 덩어리 기기 => 이러한 데이터 링크 안에서 데이터를 어떻게 주고 받을 지를 결정하는 것이 데이터 링크 계층 프로토콜이다.
- 컴퓨터를 네트워크에 접속하기 위해서는 케이블이나 전파를 사용하지만, 어떤 방법이든 NIC(Network Interface Card)가 필요하다.  
  \*NIC란? 제조시 제조회사에 따른 고유 번호 할당, 이를 MAC주소라고 한다. 이것이 데이터 링크계층에서 수신인을 판단, 기기 식별할 때 사용.

[MAC(Media Access Control)]

- NIC안에는 MAC주소라는 고유한 번호가 할당되어 있다.
- MAC주소는 48자리 비트열을 8비트씩 :(콜론) 또는 -(하이픈)으로 구분해서 16진수로 나타낸다. ex) 67:43:a5:3b:7e:01

[ARP(Address Resolution Protocol)]

- IP주소만으로 수신인에게 전달할 수 가 없다. 데이터 링크 내에서 MAC주소를 사용하여 기기를 특정하기 때문이다.
- IP주소를 가지고 상대의 MAC주소를 알아낼 때 사용하는 프로토콜이 ARP이다.
- 방법  
   a. MAC주소를 알고싶은 컴퓨터의 IP주소를 ARP패킷에 적는다. 그리고 브로드캐스트MAC주소 앞으로 보낸다.  
  \*브로드캐스트MAC주소 : 같은 데이터 링크 내에 있는 모든 기기에게 보낼 수 있는 MAC주소이다. 모든 비트에 1이 들어가 있는 ff:ff:ff:ff:ff:ff 이다. (라우터를 넘어갈 수는 없다.)  
   b. 전달받은 기기들 중에서, 자신의 IP주소이면 MAC주소를 적은 ARP패킷을 다시 보낸다.
- ARP패킷의 데이터 구조 : **ARP패킷은 데이터 링크 계층의 프로토콜에서 캡슐화되어 송신 된다.**  
  a. 하드웨어 타입(16비트) : 사용하는 데이터 링크의 종류  
  b. 프로토콜 타입(16비트) : 상위 프로토콜의 종류  
  c. 하드웨어 크기(8비트) : MAC주소의 크기를 바이트로 나타낸 것  
  d. 프로토콜 크기(8비트) : 상위 프로토콜에서 사용되는 주소의 크기를 바이트로 나타낸 것  
  e. 오퍼레이션(16비트) : 패킷의 종류. 요청은 1, 응답은 10이 들어간다.(2진수 표기)  
  f. 송신측 MAC주소(48비트)
  g. 송신측 IP주소(32비트)
  h. 수신측 MAC주소(48비트) : 요청 시에는 모두 0이 들어가 있다.  
  i. 수신측 IP주소(32비트) : 프레임 크기에 맞춰 이 뒤에 패딩을 붙이기도 한다.
- IPv6는 ARP를 사용하지 않고, ICMPv6의 이웃탐색이라는 기능을 사용해서 MAC주소를 해결한다.

2. 데이터 링크 계층 구성요소
   (1) 노드 : 데이터 링크 상에 있는 기기 ex)컴퓨터, 라우터  
   (2) 통신 매체 : 노드 간에 연결하는 케이블 ex) 금속선 케이블(구리선), 광섬유 케이블(유리), 무선
   a. 금속선 케이블 : 전압의 변화로 신호를 전달하는데 파형이 일그러지기 쉽다. 그래서 장거리 전송시 신호를 증폭 및 수정하는 장치의 리피터가 필요하다.  
   b. 광섬유 케이블 : 빛의 점멸로 신호 전달로 원거리 전송이 가능하다. 주변 전파의 영향을 받지 않는다. (금속선 케이블보다 비쌈.) ex) FDDI

- FDDI(Fiber Distributed Data Interface) : 이중 링을 만들고, 1차링으로 통신하다가 끊어지면 2차링이 통신을 계속해서 할 수 있다.  
  c. 무선 : 전파나 적외선으로 신호를 전달. 노드 간의 거리나 장애물, 주변 전파의 영향에 따라 통신이 안 될 수 있다.
- IEEE 802.11 : 현재 보급된 무선 LAN의 표준 규격(주파수 대역과 통신 속도에 따라 규격이 나뉜다. ex) IEEE 802.11a, IEEE 802.11ad) => CSMA/CA방식으로 통신  
  (3) 노드와 통신 매체를 연결하는 기기 : 비트열과 신호를 변환하는 것. ex) NIC, 모뎀

3. 연결 방법

- 버스형 : 축이 되는 케이블에서 선을 빼서 그 끝에 노드를 연결, 노드를 붙이고 떼는 것이 간단
- 링형 : 양쪽 노드를 연결하여 링 모양으로 연결, 노드의 고장이나 케이블이 고장이 한 군데라도 나면 전체 통신이 불가능
- 스타형 : 하나의 노드(허브)를 사이에 두고 다른 노드들이 연결. 중심이 고장나면 전체 통신에 영향을 미친다.
- 망형 : 모든 노드를 일대일로 연결. 일부 케이블이나 노드가 고장 나도 피해서 계속해서 통신을 할 수 있다. (주로 WAN의 접속 형태)

4. 유선 LAN에 사용되는 규격
   (1) 이더넷

- 초기 이더넷 : CSMA/CD방식(반이중통신)은 양방향 통신이 아닌 한 쪽 씩 번갈아가면서 전송하는 통신을 말한다. ex) 리피터 허브, A -> B , A <- B =>만약 여러 노드가 같은 케이블을 쓰는데 동시에 프레임을 보내면 데이터(신호)가 **충돌**한다. 그러면 데이터가 깨지고, 조금 있다가 다시 보낸다.
- 현재 이더넷 : 전이중 통신, 양방향으로 동시에 데이터를 송수신하는 통신 방법 ex) 스위칭 허브, A <-> B
- 이더넷 프레임  
   a. 동기용 신호(56비트) : 수신측에 프레임을 받을 준비를 시키기 위한 값.  
   b. 개시 부호(8비트) : 이 다음에 프레임이 시작된다는 것을 나타내는 값.  
   c. 수신측 MAC주소(48비트)  
   d. 송신측 MAC주소(48비트)  
   e. 프레임 길이/ 타입(16비트) : 프레임 길이나 최상위 프로토콜에 전달하는 정보가 들어간다.  
   f. 데이터 : 캡슐화 된 IP헤더, TCP헤더, 애플리케이션 헤더, 데이터가 들어간다.  
   g. FCS(Frame Check Sequence, 32비트) : 프레임이 깨지지 않았는지 조사.  
  (2) 토큰 링(IEEE 802.5)
- 네트워크 상을 흐르는 토큰이라는 프레임을 사용하여 통신. 토큰을 취득한 컴퓨터만 송신할 수 있다. 프레임 충돌이 발생하지 않는다. => 이런 통신 방법을 토큰 패싱 방법이라고 한다.
- 이더넷이 보급되면서 지금은 거의 사용되지 않는다.
- 토큰 링 프레임
  a. 개시 부호(8비트)
  b. 액세스 제어(8비트)
  c. 프레임 제어(8비트) : MAC주소를 사용하는 통신인지 아닌지를 나타낸다.  
  d. 수신측 MAC주소(48비트)  
  e. 송신측 MAC주소(48비트)  
  f. 데이터 : 캡슐화 된 IP헤더, TCP헤더, 애플리케이션 헤더, 데이터가 들어간다.  
  g. FCS(Frame Check Sequence, 32비트) : 프레임이 깨지지 않았는지 조사.  
  h. 종료 부호(8비트)  
  i. 프레임 상태(8비트) : 수령 신호

5. 프로토콜종류
   (1)PPP(Point-to-Point Protocol)

- 두 지점 간에 일대일 통신을 수행하는 프로토콜로 사용자 인증 기능이 추가되어 있다.
- 1대1 통신이므로 MAC주소를 사용하지 않는다.
- PPP프레임
  a. 개시 부호(8비트)
  b. 주소(8비트) : 고정값이 들어간다.(11111111)
  c. 제어부(8비트) : 전송을 제어하기 위한 정보  
   d. 프로토콜부(8비트) : 상위 계층의 프로토콜을 지정  
   e. 데이터 : 캡슐화 된 IP헤더, TCP헤더, 애플리케이션 헤더, 데이터가 들어간다.  
   f. FCS(Frame Check Sequence, 32비트) : 프레임이 깨지지 않았는지 조사.  
   g. 종료 부호(8비트)  
  (2)PPPoE(PPP over Ethernet)
- 이더넷 상에서도 사용할 수 있도록 확장한 것.
- PPPoE 프레임 : PPPoE 프레임은 이더넷 프레임 안에 포함되어 전송된다.  
  a. 겉에 이더넷이 감싸져 있다.
  b. 버전(4비트) : PPPoE의 버전
  c. 타입(4비트) : PPPoE의 타입  
  d. 코드 비트(8비트) : PPPoE 패킷의 종류  
  e. 세션ID(16비트) : PPPoE를 사용한 통신을 수행하기 위한 고유의 값  
  f. 데이터 길이(16비트) : 데이터부의 길이
  g. 데이터 : PPP헤더가 들어가고, 이 정보를 사용하여 PPP통신을 수행

6. 통신을 보조하는 기기
   (1) 리피터

- 신호의 일그러짐을 방지하기 위해 신호를 보정하는 기기 => 현재는 허브가 리피터 역할을 한다.  
  (2) 브리지 ????????????????????????????????
- 서로 다른 두 개의 데이터 링크를 연결하는 기능을 가진 기기
- 수신처의 MAC주소를 보고 흘러온 것과 다른 데이터 링크 앞으로 온 것이면 보내고, 같은 데이터 링크 앞으로 온 것이면 파기  
  (3) 허브
- 네트워크 상에서 케이블을 분기하기 위한 기기
- 하나의 신호를 여러 개의 케이블로 보내기 위해 신호를 증폭 => 신호의 보정이나 증폭 기능이 없는 **패시브 허브**라는 기기도 있음
- 스위칭 허브 : 목적지MAC주소를 보고, 특정 노드에만 신호를 보내는 기능 => 특정 노드에만 신호를 보내기 때문에 일반 허브보다 통과 시간이 오래 걸린다.
